"use strict";(self["webpackChunkforum_front_end_vue"]=self["webpackChunkforum_front_end_vue"]||[]).push([[958],{4958:function(t,e,s){s.r(e),s.d(e,{default:function(){return Z}});var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container py-5"},[s("h1",[t._v("餐廳描述頁")]),t.isLoading?s("Spinner"):[s("RestaurantDetail",{attrs:{"initial-restaurant":t.restaurant}}),s("hr"),s("RestaurantComments",{attrs:{"initial-restaurant-comments":t.restaurantComments},on:{"child-delete-comment":t.afterDeleteComment}}),s("CreateComment",{attrs:{"restaurant-id":t.restaurant.id},on:{"after-create-comment":t.afterCreateComment}})]],2)},a=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12 mb-3"},[s("h1",[t._v(t._s(t.restaurant.name))]),s("p",{staticClass:"badge badge-secondary mt-1 mb-3"},[t._v(" "+t._s(t.restaurant.categoryName)+" ")])]),s("div",{staticClass:"col-lg-4"},[s("img",{staticClass:"img-responsive center-block",staticStyle:{width:"250px","margin-bottom":"25px"},attrs:{src:t._f("emptyImageFilter")(t.restaurant.image)}}),s("div",{staticClass:"contact-info-wrap"},[s("ul",{staticClass:"list-unstyled"},[s("li",[s("strong",[t._v("Opening Hour:")]),t._v(" "+t._s(t.restaurant.openingHours)+" ")]),s("li",[s("strong",[t._v("Tel:")]),t._v(" "+t._s(t.restaurant.tel)+" ")]),s("li",[s("strong",[t._v("Address:")]),t._v(" "+t._s(t.restaurant.address)+" ")])])])]),s("div",{staticClass:"col-lg-8"},[s("p",[t._v(t._s(t.restaurant.description))]),s("router-link",{staticClass:"btn btn-primary btn-border mr-2",attrs:{to:{name:"restaurant-dashboard",params:{id:t.restaurant.id}}}},[t._v("Dashboard")]),t.restaurant.isFavorited?s("button",{staticClass:"btn btn-danger btn-border mr-2",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteFavorite.apply(null,arguments)}}},[t._v(" 移除最愛 ")]):s("button",{staticClass:"btn btn-primary btn-border mr-2",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addFavorite.apply(null,arguments)}}},[t._v(" 加到最愛 ")]),t.restaurant.isLiked?s("button",{staticClass:"btn btn-danger like mr-2",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteLike.apply(null,arguments)}}},[t._v(" Unlike ")]):s("button",{staticClass:"btn btn-primary like mr-2",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addLike.apply(null,arguments)}}},[t._v(" Like ")])],1)])},i=[],o=(s(1703),s(8247)),c=s(1926),u=s(6017),l={mixins:[o.Lf],props:{initialRestaurant:{type:Object,required:!0}},data(){return{restaurant:this.initialRestaurant,isProcessing:!1}},watch:{initialRestaurant(t){this.restaurant={...this.restaurant,...t}}},methods:{addFavorite:async function(){try{this.isProcessing=!0;const{data:t}=await u.Z.addFavorite(this.restaurant.id);if("success"!==t.status)throw new Error(t.message);this.restaurant.isFavorited=!0,this.isProcessing=!1}catch(t){this.isProcessing=!1,console.log("error: ",t),c.F.fire({icon:"error",title:"無法將餐廳加入最愛，請稍後再試"})}},deleteFavorite:async function(){try{this.isProcessing=!0;const{data:t}=await u.Z.deleteFavorite(this.restaurant.id);if("success"!==t.status)throw new Error(t.message);this.restaurant.isFavorited=!1,this.isProcessing=!1}catch(t){this.isProcessing=!1,console.log("error: ",t),c.F.fire({icon:"error",title:"無法將餐廳移除最愛，請稍後再試"})}},addLike:async function(){try{this.isProcessing=!0;const{data:t}=await u.Z.addLike(this.restaurant.id);if("success"!==t.status)throw new Error(t.message);this.restaurant.isLiked=!0,this.isProcessing=!1}catch(t){this.isProcessing=!1,console.log("error: ",t),c.F.fire({icon:"error",title:"無法Like餐廳，請稍後再試"})}},deleteLike:async function(){try{this.isProcessing=!0;const{data:t}=await u.Z.deleteLike(this.restaurant.id);if("success"!==t.status)throw new Error(t.message);this.restaurant.isLiked=!1,this.isProcessing=!1}catch(t){this.isProcessing=!1,console.log("error: ",t),c.F.fire({icon:"error",title:"無法Unlike餐廳，請稍後再試"})}}}},m=l,d=s(1001),h=(0,d.Z)(m,n,i,!1,null,"363b6ec2",null),p=h.exports,f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h2",{staticClass:"my-4"},[t._v("所有評論：")]),t._l(t.restaurantComments,(function(e){return s("div",{key:e.id},[s("blockquote",{staticClass:"blockquote mb-0"},[t.currentUser.isAdmin?s("button",{staticClass:"btn btn-danger float-right",attrs:{type:"button"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.childDeleteComment(e.id)}}},[t._v(" Delete ")]):t._e(),s("h3",[s("router-link",{attrs:{to:{name:"user",params:{id:e.User.id}}}},[t._v(" "+t._s(e.User.name)+" ")])],1),s("p",[t._v(t._s(e.text))]),s("footer",{staticClass:"blockquote-footer"},[t._v(" "+t._s(t._f("fromNow")(e.createdAt))+" ")])]),s("hr")])}))],2)},g=[],b=s(1947),v={mixins:[o.qk],props:{initialRestaurantComments:{type:Array,required:!0}},data(){return{restaurantComments:this.initialRestaurantComments}},watch:{initialRestaurantComments(t){this.restaurantComments=t}},methods:{async childDeleteComment(t){try{const{data:e}=await b.Z.comments["delete"]({commentId:t});if("success"!==e.status)throw new Error(e.message);this.$emit("child-delete-comment",t)}catch(e){console.log("error: ",e),c.F.fire({icon:"error",title:"無法刪除評論，請稍後再試"})}}},computed:{currentUser(){return{id:-1,name:"",email:"",image:"",isAdmin:!1,...this.$store.state.currentUser}}}},C=v,_=(0,d.Z)(C,f,g,!1,null,"6c19448a",null),y=_.exports,k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSummit.apply(null,arguments)}}},[s("div",{staticClass:"form-group mb-4"},[s("label",{attrs:{for:"text"}},[t._v("留下評論：")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],staticClass:"form-control",attrs:{rows:"3",name:"text"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}})]),s("div",{staticClass:"d-flex align-items-center justify-content-between"},[s("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$router.back()}}},[t._v(" 回上一頁 ")]),s("button",{staticClass:"btn btn-primary mr-0",attrs:{type:"submit"}},[t._v("Submit")])])])},w=[],x={name:"CreateComment",props:{restaurantId:{type:Number,required:!0}},data(){return{text:""}},computed:{userId(){return this.$store.state.currentUser.id}},methods:{async handleSummit(){try{if(this.text=this.text.trim(),""===this.text)return void c.F.fire({icon:"warning",title:"無法新增空白留言"});const{data:t}=await b.Z.comments.create({text:this.text,restaurantId:this.restaurantId,id:this.userId});if("success"!==t.status)throw new Error(t.message);this.$emit("after-create-comment",{commentId:t.commentId,restaurantId:this.restaurantId,text:this.text}),this.text=""}catch(t){console.log("error: ",t),c.F.fire({icon:"error",title:"無法新增留言，請稍後再試"})}}}},P=x,F=(0,d.Z)(P,k,w,!1,null,"e60559b6",null),L=F.exports,R=s(2907),D={name:"Restaurant",components:{RestaurantDetail:p,RestaurantComments:y,CreateComment:L,Spinner:R.Z},data(){return{restaurant:{id:-1,name:"",tel:"",address:"",openingHours:"",description:"",image:"",categoryName:"",isFavorited:!1,isLiked:!1},restaurantComments:[],isLoading:!0}},computed:{currentUser(){return{id:-1,name:"",email:"",image:"",isAdmin:!1,...this.$store.state.currentUser}}},created(){const{id:t}=this.$route.params;this.fetchRestaurant(t)},beforeRouteUpdate(t,e,s){this.fetchRestaurant(t.params.id),s()},methods:{fetchRestaurant:async function(t){try{this.isLoading=!0;const{data:e}=await b.Z.getRestaurant({restaurantId:t}),{id:s,name:r,tel:a,address:n,opening_hours:i,description:o,image:c,Category:u}=e.restaurant,{isFavorited:l,isLiked:m}=e;this.restaurant={id:s,name:r,tel:a,address:n,openingHours:i,description:o,image:c,categoryName:u?u.name:"未分類",isFavorited:l,isLiked:m},this.restaurantComments=e.restaurant.Comments,this.isLoading=!1}catch(e){this.isLoading=!1,console.log("error: ",e),c.F.fire({icon:"error",title:"無法取得餐廳資料，請稍後再試"})}},afterDeleteComment:function(t){console.log("afterDeleteComment",t),this.restaurantComments=this.restaurantComments.filter((e=>e.id!==t))},afterCreateComment:function(t){const{commentId:e,restaurantId:s,text:r}=t;this.restaurantComments.push({id:e,text:r,RestaurantId:s,createdAt:new Date,User:{id:this.currentUser.id,name:this.currentUser.name}})}}},I=D,U=(0,d.Z)(I,r,a,!1,null,null,null),Z=U.exports}}]);
//# sourceMappingURL=958.7a683d19.js.map